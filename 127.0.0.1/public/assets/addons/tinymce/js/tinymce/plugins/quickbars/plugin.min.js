/**
 * Copyright (c) Tiny Technologies, Inc. All rights reserved.
 * Licensed under the LGPL or a commercial license.
 * For LGPL see License.txt in the project root for license information.
 * For commercial licenses see https://www.tiny.cloud/
 *
 * Version: 5.3.0 (TBD)
 */
!function(s){"use strict";var e,n,r,t,o=tinymce.util.Tools.resolve("tinymce.PluginManager"),a=0,c=function(e,n,r){var t,o,i,u;o=(t=e.editorUpload.blobCache).create((i="mceu",u=(new Date).getTime(),i+"_"+Math.floor(1e9*Math.random())+ ++a+String(u)),r,n),t.add(o),e.insertContent(e.dom.createHTML("img",{src:o.blobUri()}))},f=tinymce.util.Tools.resolve("tinymce.util.Promise"),d=tinymce.util.Tools.resolve("tinymce.Env"),l=tinymce.util.Tools.resolve("tinymce.util.Delay"),i=function(u){u.ui.registry.addButton("quickimage",{icon:"image",tooltip:"Insert image",onAction:function(){var i;i=u,new f(function(r){var t=s.document.createElement("input");t.type="file",t.accept="image/*",t.style.position="fixed",t.style.left="0",t.style.top="0",t.style.opacity="0.001",s.document.body.appendChild(t),t.addEventListener("change",function(e){r(Array.prototype.slice.call(e.target.files))});var o=function(e){var n=function(){r([]),t.parentNode.removeChild(t)};d.os.isAndroid()&&"remove"!==e.type?l.setEditorTimeout(i,n,0):n(),i.off("focusin remove",o)};i.on("focusin remove",o),t.click()}).then(function(e){if(0<e.length){var n=e[0];r=n,new f(function(e){var n=new s.FileReader;n.onloadend=function(){e(n.result.split(",")[1])},n.readAsDataURL(r)}).then(function(e){c(u,e,n)})}var r})}}),u.ui.registry.addButton("quicktable",{icon:"table",tooltip:"Insert table",onAction:function(){var e,n,r,t,o,i;r=n=2,(e=u).plugins.table?e.plugins.table.insertTable(n,r):(o=n,i=r,(t=e).undoManager.transact(function(){var e,n;t.insertContent(function(e,n){var r,t,o;for(o='<table data-mce-id="mce" style="width: 100%">',o+="<tbody>",t=0;t<n;t++){for(o+="<tr>",r=0;r<e;r++)o+="<td><br></td>";o+="</tr>"}return o+="</tbody>",o+="</table>"}(o,i)),(e=t.dom.select("*[data-mce-id]")[0]).removeAttribute("data-mce-id"),n=t.dom.select("td,th",e),t.selection.setCursorLocation(n[0],0)}))}})},N=function(e){return function(){return e}},u=N(!1),m=N(!0),g=function(){return h},h=(e=function(e){return e.isNone()},{fold:function(e,n){return e()},is:u,isSome:u,isNone:m,getOr:r=function(e){return e},getOrThunk:n=function(e){return e()},getOrDie:function(e){throw new Error(e||"error: getOrDie called on none.")},getOrNull:N(null),getOrUndefined:N(undefined),or:r,orThunk:n,map:g,each:function(){},bind:g,exists:u,forall:m,filter:g,equals:e,equals_:e,toArray:function(){return[]},toString:N("none()")}),v=function(r){var e=N(r),n=function(){return o},t=function(e){return e(r)},o={fold:function(e,n){return n(r)},is:function(e){return r===e},isSome:m,isNone:u,getOr:e,getOrThunk:e,getOrDie:e,getOrNull:e,getOrUndefined:e,or:n,orThunk:n,map:function(e){return v(e(r))},each:function(e){e(r)},bind:t,exists:t,forall:t,filter:function(e){return e(r)?o:h},toArray:function(){return[r]},toString:function(){return"some("+r+")"},equals:function(e){return e.is(r)},equals_:function(e,n){return e.fold(u,function(e){return n(r,e)})}};return o},p={some:v,none:g,from:function(e){return null===e||e===undefined?h:v(e)}},b=function(e){if(null===e||e===undefined)throw new Error("Node cannot be null or undefined");return{dom:N(e)}},E={fromHtml:function(e,n){var r=(n||s.document).createElement("div");if(r.innerHTML=e,!r.hasChildNodes()||1<r.childNodes.length)throw s.console.error("HTML does not have a single root node",e),new Error("HTML must have a single root node");return b(r.childNodes[0])},fromTag:function(e,n){var r=(n||s.document).createElement(e);return b(r)},fromText:function(e,n){var r=(n||s.document).createTextNode(e);return b(r)},fromDom:b,fromPoint:function(e,n,r){var t=e.dom();return p.from(t.elementFromPoint(n,r)).map(b)}},O=("undefined"!=typeof s.window?s.window:Function("return this;")(),s.Node.ATTRIBUTE_NODE,s.Node.CDATA_SECTION_NODE,s.Node.COMMENT_NODE,s.Node.DOCUMENT_NODE,s.Node.DOCUMENT_TYPE_NODE,s.Node.DOCUMENT_FRAGMENT_NODE,s.Node.ELEMENT_NODE),w=(s.Node.TEXT_NODE,s.Node.PROCESSING_INSTRUCTION_NODE,s.Node.ENTITY_REFERENCE_NODE,s.Node.ENTITY_NODE,s.Node.NOTATION_NODE,function(t){return function(e){return r=typeof(n=e),(null===n?"null":"object"==r&&(Array.prototype.isPrototypeOf(n)||n.constructor&&"Array"===n.constructor.name)?"array":"object"==r&&(String.prototype.isPrototypeOf(n)||n.constructor&&"String"===n.constructor.name)?"string":r)===t;var n,r}}),S=function(n){return function(e){return typeof e===n}},T=w("string"),y=w("object"),x=w("array"),k=S("boolean"),C=(t=undefined,function(e){return t===e}),D=S("function");function _(e,n,r,t,o){return e(r,t)?p.some(r):D(o)&&o(r)?p.none():n(r,t,o)}var R,M,A,I=function(e,n){var r=function(e,n){for(var r=0;r<e.length;r++){var t=e[r];if(t.test(n))return t}return undefined}(e,n);if(!r)return{major:0,minor:0};var t=function(e){return Number(n.replace(r,"$"+e))};return L(t(1),t(2))},q=function(){return L(0,0)},L=function(e,n){return{major:e,minor:n}},P={nu:L,detect:function(e,n){var r=String(n).toLowerCase();return 0===e.length?q():I(e,r)},unknown:q},F="Firefox",U=function(e){var n=e.current,r=e.version,t=function(e){return function(){return n===e}};return{current:n,version:r,isEdge:t("Edge"),isChrome:t("Chrome"),isIE:t("IE"),isOpera:t("Opera"),isFirefox:t(F),isSafari:t("Safari")}},B={unknown:function(){return U({current:undefined,version:P.unknown()})},nu:U,edge:N("Edge"),chrome:N("Chrome"),ie:N("IE"),opera:N("Opera"),firefox:N(F),safari:N("Safari")},j="Windows",H="Android",X="Solaris",G="FreeBSD",W="ChromeOS",Y=function(e){var n=e.current,r=e.version,t=function(e){return function(){return n===e}};return{current:n,version:r,isWindows:t(j),isiOS:t("iOS"),isAndroid:t(H),isOSX:t("OSX"),isLinux:t("Linux"),isSolaris:t(X),isFreeBSD:t(G),isChromeOS:t(W)}},z={unknown:function(){return Y({current:undefined,version:P.unknown()})},nu:Y,windows:N(j),ios:N("iOS"),android:N(H),linux:N("Linux"),osx:N("OSX"),solaris:N(X),freebsd:N(G),chromeos:N(W)},$=function(e,n){var r=String(n).toLowerCase();return function(e,n){for(var r=0,t=e.length;r<t;r++){var o=e[r];if(n(o,r))return p.some(o)}return p.none()}(e,function(e){return e.search(r)})},V=function(e,r){return $(e,r).map(function(e){var n=P.detect(e.versionRegexes,r);return{current:e.name,version:n}})},J=function(e,r){return $(e,r).map(function(e){var n=P.detect(e.versionRegexes,r);return{current:e.name,version:n}})},K=function(e,n){return-1!==e.indexOf(n)},Q=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,Z=function(n){return function(e){return K(e,n)}},ee=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(e){return K(e,"edge/")&&K(e,"chrome")&&K(e,"safari")&&K(e,"applewebkit")}},{name:"Chrome",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,Q],search:function(e){return K(e,"chrome")&&!K(e,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(e){return K(e,"msie")||K(e,"trident")}},{name:"Opera",versionRegexes:[Q,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:Z("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:Z("firefox")},{name:"Safari",versionRegexes:[Q,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(e){return(K(e,"safari")||K(e,"mobile/"))&&K(e,"applewebkit")}}],ne=[{name:"Windows",search:Z("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(e){return K(e,"iphone")||K(e,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:Z("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:Z("mac os x"),versionRegexes:[/.*?mac\ os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:Z("linux"),versionRegexes:[]},{name:"Solaris",search:Z("sunos"),versionRegexes:[]},{name:"FreeBSD",search:Z("freebsd"),versionRegexes:[]},{name:"ChromeOS",search:Z("cros"),versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/]}],re={browsers:N(ee),oses:N(ne)},te=(R=function(e,n){var r,t,o,i,u,s,a,c,f,d,l,m,g=re.browsers(),h=re.oses(),v=V(g,e).fold(B.unknown,B.nu),p=J(h,e).fold(z.unknown,z.nu);return{browser:v,os:p,deviceType:(t=v,o=e,i=n,u=(r=p).isiOS()&&!0===/ipad/i.test(o),s=r.isiOS()&&!u,a=r.isiOS()||r.isAndroid(),c=a||i("(pointer:coarse)"),f=u||!s&&a&&i("(min-device-width:768px)"),d=s||a&&!f,l=t.isSafari()&&r.isiOS()&&!1===/safari/i.test(o),m=!d&&!f&&!l,{isiPad:N(u),isiPhone:N(s),isTablet:N(f),isPhone:N(d),isTouch:N(c),isAndroid:r.isAndroid,isiOS:r.isiOS,isWebView:N(l),isDesktop:N(m)})}}(s.navigator.userAgent,function(e){return s.window.matchMedia(e).matches}),M=R,{get:function(){return M},set:function(e){M=e}}),oe=O,ie=function(e,n){var r=e.dom();if(r.nodeType!==oe)return!1;var t=r;if(t.matches!==undefined)return t.matches(n);if(t.msMatchesSelector!==undefined)return t.msMatchesSelector(n);if(t.webkitMatchesSelector!==undefined)return t.webkitMatchesSelector(n);if(t.mozMatchesSelector!==undefined)return t.mozMatchesSelector(n);throw new Error("Browser lacks native selectors")},ue=(te.get().browser.isIE(),function(e,n,r){for(var t=e.dom(),o=D(r)?r:N(!1);t.parentNode;){t=t.parentNode;var i=E.fromDom(t);if(n(i))return p.some(i);if(o(i))break}return p.none()}),se=function(e,n,r){return ue(e,function(e){return ie(e,n)},r)},ae=(A=T,function(e,n,r){return function(e,n){if(!n(e))throw new Error("Default value doesn't match requested type.")}(r,A),function(e,n){if(x(e)||y(e))throw new Error("expected a string but found: "+e);return C(e)?n:k(e)?!1===e?"":n:e}(e.getParam(n,r),r)}),ce=function(o){var e=ae(o,"quickbars_insert_toolbar","quickimage quicktable");0<e.trim().length&&o.ui.registry.addContextToolbar("quickblock",{predicate:function(e){var n=E.fromDom(e),r=o.schema.getTextBlockElements(),t=function(e){return e.dom()===o.getBody()};return _(function(e,n){return ie(e,n)},se,n,"table",t).fold(function(){return _(function(e,n){return n(e)},ue,n,function(e){return e.dom().nodeName.toLowerCase()in r&&o.dom.isEmpty(e.dom())},t).isSome()},function(){return!1})},items:e,position:"line",scope:"editor"})},fe=function(r){var t=function(e){return"IMG"===e.nodeName||"FIGURE"===e.nodeName&&/image/i.test(e.className)},e=ae(r,"quickbars_image_toolbar","alignleft aligncenter alignright");0<e.trim().length&&r.ui.registry.addContextToolbar("imageselection",{predicate:t,items:e,position:"node"});var n=ae(r,"quickbars_selection_toolbar","bold italic | quicklink h2 h3 blockquote");0<n.trim().length&&r.ui.registry.addContextToolbar("textselection",{predicate:function(e){return!t(e)&&!r.selection.isCollapsed()&&(n=e,"false"!==r.dom.getContentEditableParent(n));var n},items:n,position:"selection",scope:"editor"})};!function de(){o.add("quickbars",function(e){i(e),ce(e),fe(e)})}()}(window);