/**
 * Copyright (c) Tiny Technologies, Inc. All rights reserved.
 * Licensed under the LGPL or a commercial license.
 * For LGPL see License.txt in the project root for license information.
 * For commercial licenses see https://www.tiny.cloud/
 *
 * Version: 5.3.0 (TBD)
 */
!function(a){"use strict";var e,n,t,r,s=tinymce.util.Tools.resolve("tinymce.PluginManager"),N=function(e){return function(){return e}},o=function(n){return function(e){return!n(e)}},i=N(!1),u=N(!0),c=function(){return f},f=(e=function(e){return e.isNone()},{fold:function(e,n){return e()},is:i,isSome:i,isNone:u,getOr:t=function(e){return e},getOrThunk:n=function(e){return e()},getOrDie:function(e){throw new Error(e||"error: getOrDie called on none.")},getOrNull:N(null),getOrUndefined:N(undefined),or:t,orThunk:n,map:c,each:function(){},bind:c,exists:i,forall:u,filter:c,equals:e,equals_:e,toArray:function(){return[]},toString:N("none()")}),d=function(t){var e=N(t),n=function(){return o},r=function(e){return e(t)},o={fold:function(e,n){return n(t)},is:function(e){return t===e},isSome:u,isNone:i,getOr:e,getOrThunk:e,getOrDie:e,getOrNull:e,getOrUndefined:e,or:n,orThunk:n,map:function(e){return d(e(t))},each:function(e){e(t)},bind:r,exists:r,forall:r,filter:function(e){return e(t)?o:f},toArray:function(){return[t]},toString:function(){return"some("+t+")"},equals:function(e){return e.is(t)},equals_:function(e,n){return e.fold(i,function(e){return n(t,e)})}};return o},l={some:d,none:c,from:function(e){return null===e||e===undefined?f:d(e)}},m=function(r){return function(e){return t=typeof(n=e),(null===n?"null":"object"==t&&(Array.prototype.isPrototypeOf(n)||n.constructor&&"Array"===n.constructor.name)?"array":"object"==t&&(String.prototype.isPrototypeOf(n)||n.constructor&&"String"===n.constructor.name)?"string":t)===r;var n,t}},g=function(n){return function(e){return typeof e===n}},p=m("string"),v=m("array"),h=g("boolean"),y=g("function"),O=g("number"),S=Array.prototype.slice,C=Array.prototype.push,b=function(e,n){for(var t=e.length,r=new Array(t),o=0;o<t;o++){var i=e[o];r[o]=n(i,o)}return r},T=function(e,n){for(var t=0,r=e.length;t<r;t++){n(e[t],t)}},D=function(e,n){for(var t=[],r=0,o=e.length;r<o;r++){var i=e[r];n(i,r)&&t.push(i)}return t},E=function(e,n,t){return T(e,function(e){t=n(t,e)}),t},L=function(e,n){for(var t=0,r=e.length;t<r;t++){var o=e[t];if(n(o,t))return l.some(o)}return l.none()},w=function(e,n){return function(e){for(var n=[],t=0,r=e.length;t<r;++t){if(!v(e[t]))throw new Error("Arr.flatten item "+t+" was not an array, input: "+e);C.apply(n,e[t])}return n}(b(e,n))},k=function(e){return 0===e.length?l.none():l.some(e[0])},x=function(e){return 0===e.length?l.none():l.some(e[e.length-1])},A=function(){return(A=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var o in n=arguments[t])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e}).apply(this,arguments)},I=function(e){var n=e;return{get:function(){return n},set:function(e){n=e}}},R=function(e,n){var t=function(e,n){for(var t=0;t<e.length;t++){var r=e[t];if(r.test(n))return r}return undefined}(e,n);if(!t)return{major:0,minor:0};var r=function(e){return Number(n.replace(t,"$"+e))};return P(r(1),r(2))},B=function(){return P(0,0)},P=function(e,n){return{major:e,minor:n}},_={nu:P,detect:function(e,n){var t=String(n).toLowerCase();return 0===e.length?B():R(e,t)},unknown:B},M="Edge",U="Chrome",F="Opera",$="Firefox",H="Safari",j=function(e){var n=e.current,t=e.version,r=function(e){return function(){return n===e}};return{current:n,version:t,isEdge:r(M),isChrome:r(U),isIE:r("IE"),isOpera:r(F),isFirefox:r($),isSafari:r(H)}},q={unknown:function(){return j({current:undefined,version:_.unknown()})},nu:j,edge:N(M),chrome:N(U),ie:N("IE"),opera:N(F),firefox:N($),safari:N(H)},K="Windows",V="Android",W="Solaris",X="FreeBSD",Q="ChromeOS",Y=function(e){var n=e.current,t=e.version,r=function(e){return function(){return n===e}};return{current:n,version:t,isWindows:r(K),isiOS:r("iOS"),isAndroid:r(V),isOSX:r("OSX"),isLinux:r("Linux"),isSolaris:r(W),isFreeBSD:r(X),isChromeOS:r(Q)}},z={unknown:function(){return Y({current:undefined,version:_.unknown()})},nu:Y,windows:N(K),ios:N("iOS"),android:N(V),linux:N("Linux"),osx:N("OSX"),solaris:N(W),freebsd:N(X),chromeos:N(Q)},G=function(e,n){var t=String(n).toLowerCase();return L(e,function(e){return e.search(t)})},J=function(e,t){return G(e,t).map(function(e){var n=_.detect(e.versionRegexes,t);return{current:e.name,version:n}})},Z=function(e,t){return G(e,t).map(function(e){var n=_.detect(e.versionRegexes,t);return{current:e.name,version:n}})},ee=function(e,n){return-1!==e.indexOf(n)},ne=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,te=function(n){return function(e){return ee(e,n)}},re=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(e){return ee(e,"edge/")&&ee(e,"chrome")&&ee(e,"safari")&&ee(e,"applewebkit")}},{name:"Chrome",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,ne],search:function(e){return ee(e,"chrome")&&!ee(e,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(e){return ee(e,"msie")||ee(e,"trident")}},{name:"Opera",versionRegexes:[ne,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:te("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:te("firefox")},{name:"Safari",versionRegexes:[ne,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(e){return(ee(e,"safari")||ee(e,"mobile/"))&&ee(e,"applewebkit")}}],oe=[{name:"Windows",search:te("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(e){return ee(e,"iphone")||ee(e,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:te("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:te("mac os x"),versionRegexes:[/.*?mac\ os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:te("linux"),versionRegexes:[]},{name:"Solaris",search:te("sunos"),versionRegexes:[]},{name:"FreeBSD",search:te("freebsd"),versionRegexes:[]},{name:"ChromeOS",search:te("cros"),versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/]}],ie={browsers:N(re),oses:N(oe)},ue=I(function(e,n){var t,r,o,i,u,a,s,c,f,d,l,m,g=ie.browsers(),p=ie.oses(),v=J(g,e).fold(q.unknown,q.nu),h=Z(p,e).fold(z.unknown,z.nu);return{browser:v,os:h,deviceType:(r=v,o=e,i=n,u=(t=h).isiOS()&&!0===/ipad/i.test(o),a=t.isiOS()&&!u,s=t.isiOS()||t.isAndroid(),c=s||i("(pointer:coarse)"),f=u||!a&&s&&i("(min-device-width:768px)"),d=a||s&&!f,l=r.isSafari()&&t.isiOS()&&!1===/safari/i.test(o),m=!d&&!f&&!l,{isiPad:N(u),isiPhone:N(a),isTablet:N(f),isPhone:N(d),isTouch:N(c),isAndroid:t.isAndroid,isiOS:t.isiOS,isWebView:N(l),isDesktop:N(m)})}}(a.navigator.userAgent,function(e){return a.window.matchMedia(e).matches})),ae=function(e){if(null===e||e===undefined)throw new Error("Node cannot be null or undefined");return{dom:N(e)}},se={fromHtml:function(e,n){var t=(n||a.document).createElement("div");if(t.innerHTML=e,!t.hasChildNodes()||1<t.childNodes.length)throw a.console.error("HTML does not have a single root node",e),new Error("HTML must have a single root node");return ae(t.childNodes[0])},fromTag:function(e,n){var t=(n||a.document).createElement(e);return ae(t)},fromText:function(e,n){var t=(n||a.document).createTextNode(e);return ae(t)},fromDom:ae,fromPoint:function(e,n,t){var r=e.dom();return l.from(r.elementFromPoint(n,t)).map(ae)}},ce=(a.Node.ATTRIBUTE_NODE,a.Node.CDATA_SECTION_NODE,a.Node.COMMENT_NODE,a.Node.DOCUMENT_NODE,a.Node.DOCUMENT_TYPE_NODE,a.Node.DOCUMENT_FRAGMENT_NODE,a.Node.ELEMENT_NODE),fe=(a.Node.TEXT_NODE,a.Node.PROCESSING_INSTRUCTION_NODE,a.Node.ENTITY_REFERENCE_NODE,a.Node.ENTITY_NODE,a.Node.NOTATION_NODE,ce),de=function(e,n){return e.dom()===n.dom()},le=ue.get().browser.isIE()?function(e,n){return t=e.dom(),r=n.dom(),o=t,i=r,u=a.Node.DOCUMENT_POSITION_CONTAINED_BY,0!=(o.compareDocumentPosition(i)&u);var t,r,o,i,u}:function(e,n){var t=e.dom(),r=n.dom();return t!==r&&t.contains(r)},me=function(e,n){var t=e.dom();if(t.nodeType!==fe)return!1;var r=t;if(r.matches!==undefined)return r.matches(n);if(r.msMatchesSelector!==undefined)return r.msMatchesSelector(n);if(r.webkitMatchesSelector!==undefined)return r.webkitMatchesSelector(n);if(r.mozMatchesSelector!==undefined)return r.mozMatchesSelector(n);throw new Error("Browser lacks native selectors")},ge=tinymce.util.Tools.resolve("tinymce.dom.RangeUtils"),pe=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker"),ve=tinymce.util.Tools.resolve("tinymce.util.VK"),he=function(e,n,t){return e.isSome()&&n.isSome()?l.some(t(e.getOrDie(),n.getOrDie())):l.none()},Ne=function(e){return l.from(e.dom().parentNode).map(se.fromDom)},ye=function(e){return b(e.dom().childNodes,se.fromDom)},Oe=function(e,n){var t=e.dom().childNodes;return l.from(t[n]).map(se.fromDom)},Se=function(e){return Oe(e,0)},Ce=function(e){return Oe(e,e.dom().childNodes.length-1)},be=function(n,t){Ne(n).each(function(e){e.dom().insertBefore(t.dom(),n.dom())})},Te=function(e,n){e.dom().appendChild(n.dom())},De=function(n,e){T(e,function(e){Te(n,e)})},Ee=function(e){var n=e.dom();null!==n.parentNode&&n.parentNode.removeChild(n)},Le=function(e,n,t){return e.fire("ListMutation",{action:n,element:t})},we=("undefined"!=typeof a.window?a.window:Function("return this;")(),tinymce.util.Tools.resolve("tinymce.dom.DomQuery")),ke=tinymce.util.Tools.resolve("tinymce.util.Tools"),xe=function(e){return e&&3===e.nodeType},Ae=function(e){return e&&/^(OL|UL|DL)$/.test(e.nodeName)},Ie=function(e){return e&&/^(OL|UL)$/.test(e.nodeName)},Re=function(e){return e&&/^(DT|DD)$/.test(e.nodeName)},Be=function(e){return e&&/^(TH|TD)$/.test(e.nodeName)},Pe=function(e){return e&&"BR"===e.nodeName},_e=function(e,n){return n&&!!e.schema.getTextBlockElements()[n.nodeName]},Me=function(e,n){return e&&e.nodeName in n},Ue=function(e,n,t){var r=e.isEmpty(n);return!(t&&0<e.select("span[data-mce-type=bookmark]",n).length)&&r},Fe=function(e,n){return e.isChildOf(n,e.getRoot())},$e=function(e){var n=e.selection.getStart(!0);return e.dom.getParent(n,"OL,UL,DL",qe(e,n))},He=function(e){var n,t,r,o=$e(e),i=e.selection.getSelectedBlocks();return r=i,(t=o)&&1===r.length&&r[0]===t?(n=o,ke.grep(n.querySelectorAll("ol,ul,dl"),function(e){return Ae(e)})):ke.grep(i,function(e){return Ae(e)&&o!==e})},je=function(e){var t,n,r,o=e.selection.getSelectedBlocks();return ke.grep((t=e,n=o,r=ke.map(n,function(e){var n=t.dom.getParent(e,"li,dd,dt",qe(t,e));return n||e}),we.unique(r)),function(e){return(n=e)&&/^(LI|DT|DD)$/.test(n.nodeName);var n})},qe=function(e,n){var t=e.dom.getParents(n,"TD,TH");return 0<t.length?t[0]:e.getBody()},Ke=function(e,n){var t=e.dom.getParents(n,"ol,ul",qe(e,n));return x(t)},Ve=function(e){var n,t,r,o=(t=Ke(n=e,n.selection.getStart()),r=D(n.selection.getSelectedBlocks(),Ie),t.toArray().concat(r));return We(e,o)},We=function(n,e){var t=b(e,function(e){return Ke(n,e).getOr(e)});return we.unique(t)},Xe=function(e,n){var t,r,o,i,u=e.dom,a=e.schema.getBlockElements(),s=u.createFragment(),c=!1===(t=e.getParam("forced_root_block","p"))?"":!0===t?"p":t;if(c&&((o=u.create(c)).tagName===c.toUpperCase()&&u.setAttribs(o,e.getParam("forced_root_block_attrs",{})),Me(n.firstChild,a)||s.appendChild(o)),n)for(;r=n.firstChild;){var f=r.nodeName;i||"SPAN"===f&&"bookmark"===r.getAttribute("data-mce-type")||(i=!0),Me(r,a)?(s.appendChild(r),o=null):c?(o||(o=u.create(c),s.appendChild(o)),o.appendChild(r)):s.appendChild(r)}return c?i||o.appendChild(u.create("br",{"data-mce-bogus":"1"})):s.appendChild(u.create("br")),s},Qe=Object.keys,Ye=function(e){return e.dom().nodeName.toLowerCase()},ze=(r=ce,function(e){return e.dom().nodeType===r}),Ge=function(e,n){var t=e.dom();!function(e,n){for(var t=Qe(e),r=0,o=t.length;r<o;r++){var i=t[r];n(e[i],i)}}(n,function(e,n){!function(e,n,t){if(!(p(t)||h(t)||O(t)))throw a.console.error("Invalid call to Attr.set. Key ",n,":: Value ",t,":: Element ",e),new Error("Attribute value was not simple");e.setAttribute(n,t+"")}(t,n,e)})},Je=function(e){return E(e.dom().attributes,function(e,n){return e[n.name]=n.value,e},{})},Ze=function(e,n,t){if(!p(t))throw a.console.error("Invalid call to CSS.set. Property ",n,":: Value ",t,":: Element ",e),new Error("CSS value must be a string: "+t);var r;(r=e).style!==undefined&&y(r.style.getPropertyValue)&&e.style.setProperty(n,t)},en=function(e){return n=e,t=!0,se.fromDom(n.dom().cloneNode(t));var n,t},nn=function(e,n){var t,r,o,i,u=(t=e,r=n,o=se.fromTag(r),i=Je(t),Ge(o,i),o);be(e,u);var a=ye(e);return De(u,a),Ee(e),u},tn=function(e,n){Te(e.item,n.list)},rn=function(f,e,d){var n=e.slice(0,d.depth);return x(n).each(function(e){var n,t,r,o,i,u,a,s,c=(n=f,t=d.itemAttributes,r=d.content,o=se.fromTag("li",n),Ge(o,t),De(o,r),o);u=c,Te((i=e).list,u),i.item=u,s=d,Ye((a=e).list)!==s.listType&&(a.list=nn(a.list,s.listType)),Ge(a.list,s.listAttributes)}),n},on=function(e,n,t){var r,o=function(e,n,t){for(var r,o,i,u=[],a=0;a<t;a++)u.push((r=e,o=n.listType,i={list:se.fromTag(o,r),item:se.fromTag("li",r)},Te(i.list,i.item),i));return u}(e,t,t.depth-n.length);return function(e){for(var n=1;n<e.length;n++)tn(e[n-1],e[n])}(o),function(e,n){for(var t=0;t<e.length-1;t++)r=e[t].item,o="list-style-type",i="none",u=r.dom(),Ze(u,o,i);var r,o,i,u;x(e).each(function(e){Ge(e.list,n.listAttributes),Ge(e.item,n.itemAttributes),De(e.item,n.content)})}(o,t),r=o,he(x(n),k(r),tn),n.concat(o)},un=function(e){return me(e,"OL,UL")},an=function(e){return Se(e).map(un).getOr(!1)},sn=function(e){return 0<e.depth},cn=function(e){return e.isSelected},fn=function(e){var n=ye(e),t=Ce(e).map(un).getOr(!1)?n.slice(0,-1):n;return b(t,en)},dn=function(n){T(n,function(r,e){(function(e,n){for(var t=e[n].depth,r=n-1;0<=r;r--){if(e[r].depth===t)return l.some(e[r]);if(e[r].depth<t)break}return l.none()})(n,e).each(function(e){var n,t;t=e,(n=r).listType=t.listType,n.listAttributes=A({},t.listAttributes)})})},ln=function(i,u,a,s){return Se(s).filter(un).fold(function(){u.each(function(e){de(e.start,s)&&a.set(!0)});var n,t,r,e=(n=s,t=i,r=a.get(),Ne(n).filter(ze).map(function(e){return{depth:t,isSelected:r,content:fn(n),itemAttributes:Je(n),listAttributes:Je(e),listType:Ye(e)}}));u.each(function(e){de(e.end,s)&&a.set(!1)});var o=Ce(s).filter(un).map(function(e){return mn(i,u,a,e)}).getOr([]);return e.toArray().concat(o)},function(e){return mn(i,u,a,e)})},mn=function(n,t,r,e){return w(ye(e),function(e){return(un(e)?mn:ln)(n+1,t,r,e)})},gn=function(i,e){return b(e,function(e){var n,t,r,o=(n=e.content,r=(t||a.document).createDocumentFragment(),T(n,function(e){r.appendChild(e.dom())}),se.fromDom(r));return se.fromDom(Xe(i,o.dom()))})},pn=function(e,n){return dn(n),t=e.contentDocument,r=E(n,function(e,n){return(n.depth>e.length?on:rn)(t,e,n)},[]),k(r).map(function(e){return e.list}).toArray();var t,r},vn=function(e){var n,t,r=b(je(e),se.fromDom);return he(L(r,o(an)),L((n=r,(t=S.call(n,0)).reverse(),t),o(an)),function(e,n){return{start:e,end:n}})},hn=function(a,e,s){var n,t,r,o=(n=e,t=vn(a),r=I(!1),b(n,function(e){return{sourceList:e,entries:mn(0,t,r,e)}}));T(o,function(e){var n,t;n=e.entries,t=s,T(D(n,cn),function(e){return function(e,n){switch(e){case"Indent":n.depth++;break;case"Outdent":n.depth--;break;case"Flatten":n.depth=0}}(t,e)});var r,o,i,u=(r=a,o=e.entries,w(function(e,n){if(0===e.length)return[];for(var t=n(e[0]),r=[],o=[],i=0,u=e.length;i<u;i++){var a=e[i],s=n(a);s!==t&&(r.push(o),o=[]),t=s,o.push(a)}return 0!==o.length&&r.push(o),r}(o,sn),function(e){return(k(e).map(sn).getOr(!1)?pn:gn)(r,e)}));T(u,function(e){Le(a,"Indent"===s?"IndentList":"OutdentList",e.dom())}),i=e.sourceList,T(u,function(e){be(i,e)}),Ee(e.sourceList)})},Nn=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),yn=Nn.DOM,On=function(n,t){me(t,"dd")?nn(t,"dt"):me(t,"dt")&&Ne(t).each(function(e){return function(e,n,t){var r,o,i,u,a,s;for(i=yn.select('span[data-mce-type="bookmark"]',n),a=Xe(e,t),(r=yn.createRng()).setStartAfter(t),r.setEndAfter(n),u=(o=r.extractContents()).firstChild;u;u=u.firstChild)if("LI"===u.nodeName&&e.dom.isEmpty(u)){yn.remove(u);break}e.dom.isEmpty(o)||yn.insertAfter(o,n),yn.insertAfter(a,n),Ue(e.dom,t.parentNode)&&(s=t.parentNode,ke.each(i,function(e){s.parentNode.insertBefore(e,t.parentNode)}),yn.remove(s)),yn.remove(t),Ue(e.dom,n)&&yn.remove(n)}(n,e.dom(),t.dom())})},Sn=function(e){me(e,"dt")&&nn(e,"dd")},Cn=function(e,n){if(xe(e))return{container:e,offset:n};var t=ge.getNode(e,n);return xe(t)?{container:t,offset:n>=e.childNodes.length?t.data.length:0}:t.previousSibling&&xe(t.previousSibling)?{container:t.previousSibling,offset:t.previousSibling.data.length}:t.nextSibling&&xe(t.nextSibling)?{container:t.nextSibling,offset:0}:{container:e,offset:n}},bn=function(e){var n=e.cloneRange(),t=Cn(e.startContainer,e.startOffset);n.setStart(t.container,t.offset);var r=Cn(e.endContainer,e.endOffset);return n.setEnd(r.container,r.offset),n},Tn=function(e,n){var t,r=b(Ve(e),se.fromDom),o=b(D(je(e),Re),se.fromDom),i=!1;if(r.length||o.length){var u=e.selection.getBookmark();hn(e,r,n),t=e,T(o,"Indent"===n?Sn:function(e){return On(t,e)}),e.selection.moveToBookmark(u),e.selection.setRng(bn(e.selection.getRng())),e.nodeChanged(),i=!0}return i},Dn=function(e){return Tn(e,"Indent")},En=function(e){return Tn(e,"Outdent")},Ln=function(e){return Tn(e,"Flatten")},wn=tinymce.util.Tools.resolve("tinymce.dom.BookmarkManager"),kn=Nn.DOM,xn=function(o){var i={},e=function(e){var n,t,r;t=o[e?"startContainer":"endContainer"],r=o[e?"startOffset":"endOffset"],1===t.nodeType&&(n=kn.create("span",{"data-mce-type":"bookmark"}),t.hasChildNodes()?(r=Math.min(r,t.childNodes.length-1),e?t.insertBefore(n,t.childNodes[r]):kn.insertAfter(n,t.childNodes[r])):t.appendChild(n),t=n,r=0),i[e?"startContainer":"endContainer"]=t,i[e?"startOffset":"endOffset"]=r};return e(!0),o.collapsed||e(),i},An=function(o){function e(e){var n,t,r;n=r=o[e?"startContainer":"endContainer"],t=o[e?"startOffset":"endOffset"],n&&(1===n.nodeType&&(t=function(e){for(var n=e.parentNode.firstChild,t=0;n;){if(n===e)return t;1===n.nodeType&&"bookmark"===n.getAttribute("data-mce-type")||t++,n=n.nextSibling}return-1}(n),n=n.parentNode,kn.remove(r),!n.hasChildNodes()&&kn.isBlock(n)&&n.appendChild(kn.create("br"))),o[e?"startContainer":"endContainer"]=n,o[e?"startOffset":"endOffset"]=t)}e(!0),e();var n=kn.createRng();return n.setStart(o.startContainer,o.startOffset),o.endContainer&&n.setEnd(o.endContainer,o.endOffset),bn(n)},In=function(e){return/\btox\-/.test(e.className)},Rn=function(e){switch(e){case"UL":return"ToggleUlList";case"OL":return"ToggleOlList";case"DL":return"ToggleDLList"}},Bn=function(t,e){ke.each(e,function(e,n){t.setAttribute(n,e)})},Pn=function(e,n,t){var r,o,i,u,a,s,c;r=e,o=n,u=(i=t)["list-style-type"]?i["list-style-type"]:null,r.setStyle(o,"list-style-type",u),a=e,Bn(s=n,(c=t)["list-attributes"]),ke.each(a.select("li",s),function(e){Bn(e,c["list-item-attributes"])})},_n=function(e,n,t,r){var o,i;for(o=n[t?"startContainer":"endContainer"],i=n[t?"startOffset":"endOffset"],1===o.nodeType&&(o=o.childNodes[Math.min(i,o.childNodes.length-1)]||o),!t&&Pe(o.nextSibling)&&(o=o.nextSibling);o.parentNode!==r;){if(_e(e,o))return o;if(/^(TD|TH)$/.test(o.parentNode.nodeName))return o;o=o.parentNode}return o},Mn=function(f,d,l){void 0===l&&(l={});var e,n=f.selection.getRng(!0),m="LI",t=qe(f,f.selection.getStart(!0)),g=f.dom;"false"!==g.getContentEditable(f.selection.getNode())&&("DL"===(d=d.toUpperCase())&&(m="DT"),e=xn(n),ke.each(function(t,e,r){for(var o,i=[],u=t.dom,n=_n(t,e,!0,r),a=_n(t,e,!1,r),s=[],c=n;c&&(s.push(c),c!==a);c=c.nextSibling);return ke.each(s,function(e){if(_e(t,e))return i.push(e),void(o=null);if(u.isBlock(e)||Pe(e))return Pe(e)&&u.remove(e),void(o=null);var n=e.nextSibling;wn.isBookmarkNode(e)&&(_e(t,n)||!n&&e.parentNode===r)?o=null:(o||(o=u.create("p"),e.parentNode.insertBefore(o,e),i.push(o)),o.appendChild(e))}),i}(f,n,t),function(e){var n,t,r,o,i,u,a,s,c;(t=e.previousSibling)&&Ae(t)&&t.nodeName===d&&(r=t,o=l,i=g.getStyle(r,"list-style-type"),u=o?o["list-style-type"]:"",i===(u=null===u?"":u))?(n=t,e=g.rename(e,m),t.appendChild(e)):(n=g.create(d),e.parentNode.insertBefore(n,e),n.appendChild(e),e=g.rename(e,m)),a=g,s=e,c=["margin","margin-right","margin-bottom","margin-left","margin-top","padding","padding-right","padding-bottom","padding-left","padding-top"],ke.each(c,function(e){var n;return a.setStyle(s,((n={})[e]="",n))}),Pn(g,n,l),Fn(f.dom,n)}),f.selection.setRng(An(e)))},Un=function(e,n,t){return s=t,(a=n)&&s&&Ae(a)&&a.nodeName===s.nodeName&&(i=n,u=t,(o=e).getStyle(i,"list-style-type",!0)===o.getStyle(u,"list-style-type",!0))&&(r=t,n.className===r.className);var r,o,i,u,a,s},Fn=function(e,n){var t,r;if(t=n.nextSibling,Un(e,n,t)){for(;r=t.firstChild;)n.appendChild(r);e.remove(t)}if(t=n.previousSibling,Un(e,n,t)){for(;r=t.lastChild;)n.insertBefore(r,n.firstChild);e.remove(t)}},$n=function(n,e,t,r,o){if(e.nodeName!==r||Hn(o)){var i=xn(n.selection.getRng(!0));ke.each([e].concat(t),function(e){!function(e,n,t,r){if(n.nodeName!==t){var o=e.dom.rename(n,t);Pn(e.dom,o,r),Le(e,Rn(t),o)}else Pn(e.dom,n,r),Le(e,Rn(t),n)}(n,e,r,o)}),n.selection.setRng(An(i))}else Ln(n)},Hn=function(e){return"list-style-type"in e},jn=function(e,n,t){var r=$e(e),o=He(e);t=t||{},r&&0<o.length?$n(e,r,o,n,t):function(e,n,t,r){if(n!==e.getBody())if(n)if(n.nodeName!==t||Hn(r)||In(n)){var o=xn(e.selection.getRng(!0));Pn(e.dom,n,r);var i=e.dom.rename(n,t);Fn(e.dom,i),e.selection.setRng(An(o)),Le(e,Rn(t),i)}else Ln(e);else Mn(e,t,r),Le(e,Rn(t),n)}(e,r,n,t)},qn=Nn.DOM,Kn=function(i,e){ke.each(ke.grep(i.select("ol,ul",e)),function(e){var n,t,r,o;n=i,"LI"===(o=(t=e).parentNode).nodeName&&o.firstChild===t&&((r=o.previousSibling)&&"LI"===r.nodeName?(r.appendChild(t),Ue(n,o)&&qn.remove(o)):qn.setStyle(o,"listStyleType","none")),Ae(o)&&(r=o.previousSibling)&&"LI"===r.nodeName&&r.appendChild(t)})},Vn=function(e,n,t,r){var o=n.startContainer,i=n.startOffset;if(xe(o)&&(t?i<o.data.length:0<i))return o;var u=e.schema.getNonEmptyElements();1===o.nodeType&&(o=ge.getNode(o,i));var a,s,c=new pe(o,r);for(t&&(a=e.dom,Pe(s=o)&&a.isBlock(s.nextSibling)&&!Pe(s.previousSibling)&&c.next());o=c[t?"next":"prev2"]();){if("LI"===o.nodeName&&!o.hasChildNodes())return o;if(u[o.nodeName])return o;if(xe(o)&&0<o.data.length)return o}},Wn=function(e,n){var t=n.childNodes;return 1===t.length&&!Ae(t[0])&&e.isBlock(t[0])},Xn=function(e,n,t){var r,o,i,u;if(o=Wn(e,t)?t.firstChild:t,Wn(i=e,u=n)&&i.remove(u.firstChild,!0),!Ue(e,n,!0))for(;r=n.firstChild;)o.appendChild(r)},Qn=function(n,e,t){var r,o,i=e.parentNode;if(Fe(n,e)&&Fe(n,t)){Ae(t.lastChild)&&(o=t.lastChild),i===t.lastChild&&Pe(i.previousSibling)&&n.remove(i.previousSibling),(r=t.lastChild)&&Pe(r)&&e.hasChildNodes()&&n.remove(r),Ue(n,t,!0)&&n.$(t).empty(),Xn(n,e,t),o&&t.appendChild(o);var u=le(se.fromDom(t),se.fromDom(e))?n.getParents(e,Ae,t):[];n.remove(e),T(u,function(e){Ue(n,e)&&e!==n.getRoot()&&n.remove(e)})}},Yn=function(e,n,t,r){var o,i,u,a=e.dom;if(a.isEmpty(r))i=t,u=r,(o=e).dom.$(u).empty(),Qn(o.dom,i,u),o.selection.setCursorLocation(u);else{var s=xn(n);Qn(a,t,r),e.selection.setRng(An(s))}},zn=function(n,t){var e=n.dom,r=n.selection,o=r.getStart(),i=qe(n,o),u=e.getParent(r.getStart(),"LI",i);if(u){var a=u.parentNode;if(a===n.getBody()&&Ue(e,a))return!0;var s=bn(r.getRng()),c=e.getParent(Vn(n,s,t,i),"LI",i);if(c&&c!==u)return n.undoManager.transact(function(){var e;t?Yn(n,s,c,u):(e=u).parentNode.firstChild===e?En(n):function(e,n,t,r){var o=xn(n);Qn(e.dom,t,r);var i=An(o);e.selection.setRng(i)}(n,s,u,c)}),!0;if(!c&&!t&&0===s.startOffset&&0===s.endOffset)return n.undoManager.transact(function(){Ln(n)}),!0}return!1},Gn=function(o,i){var u=o.dom,e=o.selection.getStart(),a=qe(o,e),s=u.getParent(e,u.isBlock,a);if(s&&u.isEmpty(s)){var n=bn(o.selection.getRng()),c=u.getParent(Vn(o,n,i,a),"LI",a);if(c)return o.undoManager.transact(function(){var e,n,t,r;n=s,t=a,r=(e=u).getParent(n.parentNode,e.isBlock,t),e.remove(n),r&&e.isEmpty(r)&&e.remove(r),Fn(u,c.parentNode),o.selection.select(c,!0),o.selection.collapse(i)}),!0}return!1},Jn=function(e,n){return e.selection.isCollapsed()?zn(i=e,u=n)||Gn(i,u):(r=(t=e).selection.getStart(),o=qe(t,r),!!(t.dom.getParent(r,"LI,DT,DD",o)||0<je(t).length)&&(t.undoManager.transact(function(){t.execCommand("Delete"),Kn(t.dom,t.getBody())}),!0));var t,r,o,i,u},Zn=function(n,t){return function(){var e=n.dom.getParent(n.selection.getStart(),"UL,OL,DL");return e&&e.nodeName===t}},et=function(e){var n,t;e.getParam("lists_indent_on_tab",!0)&&(n=e).on("keydown",function(e){e.keyCode!==ve.TAB||ve.metaKeyPressed(e)||n.undoManager.transact(function(){(e.shiftKey?En:Dn)(n)&&e.preventDefault()})}),(t=e).on("keydown",function(e){e.keyCode===ve.BACKSPACE?Jn(t,!1)&&e.preventDefault():e.keyCode===ve.DELETE&&Jn(t,!0)&&e.preventDefault()})},nt=function(n,i){return function(o){var e=function(e){var n=function(e,n){for(var t=0;t<e.length;t++){if(n(e[t]))return t}return-1}(e.parents,Be),t=-1!==n?e.parents.slice(0,n):e.parents,r=ke.grep(t,Ae);o.setActive(0<r.length&&r[0].nodeName===i&&!In(r[0]))};return n.on("NodeChange",e),function(){return n.off("NodeChange",e)}}};!function tt(){s.add("lists",function(e){var t,n,r,o,i,u,a;return!1==!(!/(^|[ ,])rtc([, ]|$)/.test(e.settings.plugins)||!s.get("rtc"))&&(et(e),(t=e).on("BeforeExecCommand",function(e){var n=e.command.toLowerCase();"indent"===n?Dn(t):"outdent"===n&&En(t)}),t.addCommand("InsertUnorderedList",function(e,n){jn(t,"UL",n)}),t.addCommand("InsertOrderedList",function(e,n){jn(t,"OL",n)}),t.addCommand("InsertDefinitionList",function(e,n){jn(t,"DL",n)}),t.addCommand("RemoveList",function(){Ln(t)}),t.addQueryStateHandler("InsertUnorderedList",Zn(t,"UL")),t.addQueryStateHandler("InsertOrderedList",Zn(t,"OL")),t.addQueryStateHandler("InsertDefinitionList",Zn(t,"DL"))),u=function(e){return function(){return n.execCommand(e)}},o="advlist",i=(r=n=e).settings.plugins?r.settings.plugins:"",-1===ke.inArray(i.split(/[ ,]/),o)&&(n.ui.registry.addToggleButton("numlist",{icon:"ordered-list",active:!1,tooltip:"Numbered list",onAction:u("InsertOrderedList"),onSetup:nt(n,"OL")}),n.ui.registry.addToggleButton("bullist",{icon:"unordered-list",active:!1,tooltip:"Bullet list",onAction:u("InsertUnorderedList"),onSetup:nt(n,"UL")})),a=e,{backspaceDelete:function(e){Jn(a,e)}}})}()}(window);