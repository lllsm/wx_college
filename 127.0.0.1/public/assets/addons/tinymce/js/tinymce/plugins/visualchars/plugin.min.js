/**
 * Copyright (c) Tiny Technologies, Inc. All rights reserved.
 * Licensed under the LGPL or a commercial license.
 * For LGPL see License.txt in the project root for license information.
 * For commercial licenses see https://www.tiny.cloud/
 *
 * Version: 5.3.0 (TBD)
 */
!function(o){"use strict";var n,e,t,r,u,i,c=tinymce.util.Tools.resolve("tinymce.PluginManager"),a=function(n){return function(){return n}},s=a(!1),f=a(!0),d=function(){return l},l=(n=function(n){return n.isNone()},{fold:function(n,e){return n()},is:s,isSome:s,isNone:f,getOr:t=function(n){return n},getOrThunk:e=function(n){return n()},getOrDie:function(n){throw new Error(n||"error: getOrDie called on none.")},getOrNull:a(null),getOrUndefined:a(undefined),or:t,orThunk:e,map:d,each:function(){},bind:d,exists:s,forall:f,filter:d,equals:n,equals_:n,toArray:function(){return[]},toString:a("none()")}),m=function(t){var n=a(t),e=function(){return r},o=function(n){return n(t)},r={fold:function(n,e){return e(t)},is:function(n){return t===n},isSome:f,isNone:s,getOr:n,getOrThunk:n,getOrDie:n,getOrNull:n,getOrUndefined:n,or:e,orThunk:e,map:function(n){return m(n(t))},each:function(n){n(t)},bind:o,exists:o,forall:o,filter:function(n){return n(t)?r:l},toArray:function(){return[t]},toString:function(){return"some("+t+")"},equals:function(n){return n.is(t)},equals_:function(n,e){return n.fold(s,function(n){return e(t,n)})}};return r},N=function(n){return null===n||n===undefined?l:m(n)},g=function(e){return function(n){return typeof n===e}},v=(r="string",function(n){return t=typeof(e=n),(null===e?"null":"object"==t&&(Array.prototype.isPrototypeOf(e)||e.constructor&&"Array"===e.constructor.name)?"array":"object"==t&&(String.prototype.isPrototypeOf(e)||e.constructor&&"String"===e.constructor.name)?"string":t)===r;var e,t}),h=g("boolean"),E=g("number"),T=function(n,e){for(var t=0,o=n.length;t<o;t++){e(n[t],t)}},O=Object.keys,p=function(n,e){for(var t=O(n),o=0,r=t.length;o<r;o++){var u=t[o];e(n[u],u)}},y=("undefined"!=typeof o.window?o.window:Function("return this;")(),o.Node.ATTRIBUTE_NODE,o.Node.CDATA_SECTION_NODE,o.Node.COMMENT_NODE,o.Node.DOCUMENT_NODE,o.Node.DOCUMENT_TYPE_NODE,o.Node.DOCUMENT_FRAGMENT_NODE,o.Node.ELEMENT_NODE,o.Node.TEXT_NODE),D=(o.Node.PROCESSING_INSTRUCTION_NODE,o.Node.ENTITY_REFERENCE_NODE,o.Node.ENTITY_NODE,o.Node.NOTATION_NODE,function(n){return n.dom().nodeValue}),_=(u=y,function(n){return n.dom().nodeType===u}),w=function(n,e,t){!function(n,e,t){if(!(v(t)||h(t)||E(t)))throw o.console.error("Invalid call to Attr.set. Key ",e,":: Value ",t,":: Element ",n),new Error("Attribute value was not simple");n.setAttribute(e,t+"")}(n.dom(),e,t)},C=function(n,e){n.dom().removeAttribute(e)},b=function(n,e){var t,o,r=(t=e,null===(o=n.dom().getAttribute(t))?undefined:o);return r===undefined||""===r?[]:r.split(" ")},A=function(n){return n.dom().classList!==undefined},k=function(n,e){return r=e,u=b(t=n,o="class").concat([r]),w(t,o,u.join(" ")),!0;var t,o,r,u},S=function(n,e){return r=e,0<(u=function(n,e){for(var t=[],o=0,r=n.length;o<r;o++){var u=n[o];e(u,o)&&t.push(u)}return t}(b(t=n,o="class"),function(n){return n!==r})).length?w(t,o,u.join(" ")):C(t,o),!1;var t,o,r,u},M=function(n){0===(A(n)?n.dom().classList:b(n,"class")).length&&C(n,"class")},I=function(n){if(null===n||n===undefined)throw new Error("Node cannot be null or undefined");return{dom:a(n)}},L={fromHtml:function(n,e){var t=(e||o.document).createElement("div");if(t.innerHTML=n,!t.hasChildNodes()||1<t.childNodes.length)throw o.console.error("HTML does not have a single root node",n),new Error("HTML must have a single root node");return I(t.childNodes[0])},fromTag:function(n,e){var t=(e||o.document).createElement(n);return I(t)},fromText:function(n,e){var t=(e||o.document).createTextNode(n);return I(t)},fromDom:I,fromPoint:function(n,e,t){var o=n.dom();return N(o.elementFromPoint(e,t)).map(I)}},x={"\xa0":"nbsp","\xad":"shy"},B=function(n,e){var t="";return p(n,function(n,e){t+=e}),new RegExp("["+t+"]",e?"g":"")},P=B(x),V=B(x,!0),R=(i="",p(x,function(n){i&&(i+=","),i+="span.mce-"+n}),i),U="mce-nbsp",j=function(n){return'<span data-mce-bogus="1" class="mce-'+x[n]+'">'+n+"</span>"},q=function(n){var e=D(n);return _(n)&&e!==undefined&&P.test(e)},F=function(n,e){var t=[],o=function(n,e){for(var t=n.length,o=new Array(t),r=0;r<t;r++){var u=n[r];o[r]=e(u,r)}return o}(n.dom().childNodes,L.fromDom);return T(o,function(n){e(n)&&(t=t.concat([n])),t=t.concat(F(n,e))}),t},H=function(n){return"span"===n.nodeName.toLowerCase()&&n.classList.contains("mce-nbsp-wrap")},Y=function(c,n){var e=F(L.fromDom(n),q);T(e,function(n){var e,t,o=n.dom().parentNode;if(H(o))e=L.fromDom(o),t=U,A(e)?e.dom().classList.add(t):k(e,t);else{for(var r=c.dom.encode(D(n)).replace(V,j),u=c.dom.create("div",null,r),i=void 0;i=u.lastChild;)c.dom.insertAfter(i,n.dom());c.dom.remove(n.dom())}})},G=function(e,n){var t=e.dom.select(R,n);T(t,function(n){H(n)?function(n,e){A(n)?n.dom().classList.remove(e):S(n,e);M(n)}(L.fromDom(n),U):e.dom.remove(n,!0)})},K=function(n){var e=n.getBody(),t=n.selection.getBookmark(),o=function(n,e){for(;n.parentNode;){if(n.parentNode===e)return n;n=n.parentNode}}(n.selection.getNode(),e);o=o!==undefined?o:e,G(n,o),Y(n,o),n.selection.moveToBookmark(t)},X=function(n,e){var t,o,r,u=n.getBody(),i=n.selection;e.set(!e.get()),o=n,r=e.get(),o.fire("VisualChars",{state:r}),t=i.getBookmark(),(!0===e.get()?Y:G)(n,u),i.moveToBookmark(t)},z=tinymce.util.Tools.resolve("tinymce.util.Delay"),J=function(t,o){return function(e){e.setActive(o.get());var n=function(n){return e.setActive(n.state)};return t.on("VisualChars",n),function(){return t.off("VisualChars",n)}}};!function Q(){c.add("visualchars",function(n){var e,t,o,r,u,i,c,a,s,f,d,l=(e=!1,{get:function(){return e},set:function(n){e=n}});return o=l,(t=n).addCommand("mceVisualChars",function(){X(t,o)}),u=l,(r=n).ui.registry.addToggleButton("visualchars",{tooltip:"Show invisible characters",icon:"visualchars",onAction:function(){return r.execCommand("mceVisualChars")},onSetup:J(r,u)}),r.ui.registry.addToggleMenuItem("visualchars",{text:"Show invisible characters",onAction:function(){return r.execCommand("mceVisualChars")},onSetup:J(r,u)}),i=n,c=l,a=z.debounce(function(){K(i)},300),!1!==i.settings.forced_root_block&&i.on("keydown",function(n){!0===c.get()&&(13===n.keyCode?K(i):a())}),f=l,(s=n).on("init",function(){var n=!s.getParam("visualchars_default_state",!1);f.set(n),X(s,f)}),d=l,{isEnabled:function(){return d.get()}}})}()}(window);